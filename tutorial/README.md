# Build your own Programmatic Incremental Build System

A tutorial on building your own programmatic incremental build system, aiming to teach the concepts of PIE.
Live hosted version at: <https://gohla.github.io/pie/>

## Requirements

Install mdBook and several plugins:

```shell
cargo install mdbook mdbook-admonish mdbook-external-links
```

## Building

To test all the code fragments and generate outputs in `gen` which the tutorial uses, first run:

```shell
cd stepper
cargo run
```

Then, to build the tutorial once, run:

```shell
mdbook build
```

Or to interactively build, run:

```shell
mdbook serve
```

## Generate source code

To generate all source code into `stepper/dst`, run:

```shell
cd stepper
cargo run -- step-all -d dst --skip-cargo --skip-outputs
```

## Stack & Structure

The book is built with [mdBook](https://rust-lang.github.io/mdBook/). 
We use the following mdBook plugins:

- [mdbook-admonish](https://github.com/tommilligan/mdbook-admonish)
- [mdbook-external-links](https://github.com/jonahgoldwastaken/mdbook-external-links)

Structure:

- `book.toml`: main mdBook configuration file.
- `src`: book source code.
  - `src/SUMMARY.md`: main mdBook file with the table of contents for the book.
  - `src/custom.css`: custom CSS included with the book.
  - `src/diff.js`: custom JS included with the book for diff highlighting.
  - `src/mdbook-admonish.css`: CSS for the `mdbook-admonish` plugin. This is automatically generated by the plugin.
  - `src/gen`: generated diffs and cargo outputs for the book. Part of `src` for change detection.
  - `src/*`: markdown files and code (diff) fragments of the book.
- `stepper`: command-line application (in Rust) that checks all source code (additions, insertions, diffs) by stepping over them in order and building them with cargo, ensuring that the code in the book is actually valid. It also generates diffs between source code fragments and produces outputs (such as cargo stdout) and stores them in `src/gen`.
  - `stepper/src/app.rs`: stepper instructions. Modify this to modify what/how the source code fragments of the book are checked.
- `mdbook-treesitter-table-highlight`: experimental mdBook plugin that highlights code fragments with [tree-sitter](https://tree-sitter.github.io/tree-sitter/) and outputs it as a table. Currently not used.
